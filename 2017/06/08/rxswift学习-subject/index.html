<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>rxswift学习-subject | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2017/06/08/rxswift学习-subject/">rxswift学习-subject</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">June 08 2017</p>
  </section>

  <section class="article-entry">
    <h3 id="什么是subject"><a href="#什么是subject" class="headerlink" title="什么是subject?"></a>什么是subject?</h3><p>subject既是observable也是observer。</p>
<p>他是observable就能够让我们随时调用subscribe方法，让其他Observer接收element，这个接收可以是从中间的，并不像Observable创建操作符那样，每次都从头发送全部elements。</p>
<p>他是observer就能够让我们调用他的on方法来随时动态添加emit的element。</p>
<p>这些特性也告诉了我们什么时候用observable和subject。</p>
<h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p>可以先猜想一下是怎么实现的：他是Observable，那么就需要提供subscribe函数，他也是Observer，那么就需要提供on函数。他能subscribe多个observer，那么就肯定会有一个observer数组之类的保存当前所有的observer。当on时，会调用一个循环之类的让所有observer都接收这个element。查看源码后，简单来说也就是这么实现的，不过他考虑的更多，或处理一些同步和dispose的问题。Ok，还是看看怎么用吧</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> subject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</div><div class="line"> </div><div class="line"> subject.onNext(<span class="string">"hello"</span>)</div><div class="line"> </div><div class="line"> subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">      <span class="built_in">print</span>(<span class="string">"subscriptionOne event:<span class="subst">\(event)</span>"</span>)</div><div class="line"> &#125;.disposed(by: bag)</div><div class="line">        </div><div class="line">subject.onNext(<span class="string">"1"</span>)</div><div class="line">subject.onNext(<span class="string">"2"</span>)</div><div class="line"><span class="comment">//</span></div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptiontwo event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"></div><div class="line"></div><div class="line">subject.onNext(<span class="string">"3"</span>)</div><div class="line">subject.onNext(<span class="string">"4"</span>)</div><div class="line"></div><div class="line">subject.onCompleted()</div><div class="line"></div><div class="line"> subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(<span class="string">"subscriptionthree event:<span class="subst">\(event)</span>"</span>)</div><div class="line"> &#125;.disposed(by: bag)</div><div class="line"><span class="comment">//---</span></div><div class="line">subscriptionOne event:next(<span class="number">1</span>)</div><div class="line">subscriptionOne event:next(<span class="number">2</span>)</div><div class="line">subscriptionOne event:next(<span class="number">3</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">3</span>)</div><div class="line">subscriptionOne event:next(<span class="number">4</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">4</span>)</div><div class="line">subscriptionOne event:completed</div><div class="line">subscriptiontwo event:completed</div><div class="line">subscriptionthree event:completed</div></pre></td></tr></table></figure>
<p>总的来说就是：你subscribe他之后，只能接收到subject之后on的element。如果已经error或者completed，那么会直接收到.error或.completed。</p>
<h3 id="BehaviorSubjects"><a href="#BehaviorSubjects" class="headerlink" title="BehaviorSubjects"></a>BehaviorSubjects</h3><p>和PublishSubject类似，只是会重放最后一个.next。查看源文件代码和PublishSubjects基本一样，多了个_element变量用于保存最后一个.next的值，在subscribe时，会对observer调用on方法，让他收到最后一个element。其他代码基本是一样的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">observer.on(.next(_element))</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> subject = <span class="type">BehaviorSubject</span>&lt;<span class="type">String</span>&gt;.<span class="keyword">init</span>(value: <span class="string">"初始值"</span>)</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptionOne event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"></div><div class="line">subject.onNext(<span class="string">"1"</span>)</div><div class="line">subject.onNext(<span class="string">"2"</span>)</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptiontwo event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line">subject.onNext(<span class="string">"3"</span>)</div><div class="line">subject.onNext(<span class="string">"4"</span>)</div><div class="line">subject.onCompleted()</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptionthree event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"><span class="comment">//-----</span></div><div class="line">subscriptionOne event:next(初始值)</div><div class="line">subscriptionOne event:next(<span class="number">1</span>)</div><div class="line">subscriptionOne event:next(<span class="number">2</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">2</span>)</div><div class="line">subscriptionOne event:next(<span class="number">3</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">3</span>)</div><div class="line">subscriptionOne event:next(<span class="number">4</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">4</span>)</div><div class="line">subscriptionOne event:completed</div><div class="line">subscriptiontwo event:completed</div><div class="line"><span class="comment">//可以注意到如果sequence已经退出了，此时并没有重放.next。</span></div><div class="line">subscriptionthree event:completed</div></pre></td></tr></table></figure>
<h3 id="ReplaySubjects"><a href="#ReplaySubjects" class="headerlink" title="ReplaySubjects"></a>ReplaySubjects</h3><p>本以为和上面的类似，只是存储的不是一个element，而是多个。可实际情况却不是这样，ReplaySubject只是一个抽象类。先看看继承关系图：</p>
<p><img src="http://xingou.oss-cn-shanghai.aliyuncs.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-06-08%20%E4%B8%8B%E5%8D%881.50.36.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> subject = <span class="type">ReplaySubject</span>&lt;<span class="type">String</span>&gt;.create(bufferSize: <span class="number">2</span>)</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptionOne event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"></div><div class="line">subject.onNext(<span class="string">"1"</span>)</div><div class="line">subject.onNext(<span class="string">"2"</span>)</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptiontwo event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line">subject.onNext(<span class="string">"3"</span>)</div><div class="line">subject.onNext(<span class="string">"4"</span>)</div><div class="line">subject.onCompleted()</div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"subscriptionthree event:<span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"><span class="comment">//----</span></div><div class="line">subscriptionOne event:next(<span class="number">1</span>)</div><div class="line">subscriptionOne event:next(<span class="number">2</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">1</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">2</span>)</div><div class="line">subscriptionOne event:next(<span class="number">3</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">3</span>)</div><div class="line">subscriptionOne event:next(<span class="number">4</span>)</div><div class="line">subscriptiontwo event:next(<span class="number">4</span>)</div><div class="line">subscriptionOne event:completed</div><div class="line">subscriptiontwo event:completed</div><div class="line"><span class="comment">///和behaviorsubject不同，即使退出了，也能重放之前的.next。</span></div><div class="line">subscriptionthree event:next(<span class="number">3</span>)</div><div class="line">subscriptionthree event:next(<span class="number">4</span>)</div><div class="line">subscriptionthree event:completed</div></pre></td></tr></table></figure>
<h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3><p>是对BehaviorSubject的封装。与BehaviorSubject不同的是他永远不会收到.error而结束sequence。当他deallocated时，会completed sequence。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> subject = <span class="type">Variable</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">init</span>(<span class="number">100</span>)</div><div class="line">subject.asObservable().subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"1 ) <span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line">subject.value = <span class="number">200</span></div><div class="line">subject.value = <span class="number">300</span></div><div class="line"></div><div class="line">subject.asObservable().subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"2) <span class="subst">\(event)</span>"</span>)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line">subject.value = <span class="number">300</span></div><div class="line">subject.value = <span class="number">400</span></div><div class="line"><span class="comment">//------</span></div><div class="line"><span class="number">1</span> ) next(<span class="number">100</span>)</div><div class="line"><span class="number">1</span> ) next(<span class="number">200</span>)</div><div class="line"><span class="number">1</span> ) next(<span class="number">300</span>)</div><div class="line"><span class="number">2</span>) next(<span class="number">300</span>)</div><div class="line"><span class="number">1</span> ) next(<span class="number">300</span>)</div><div class="line"><span class="number">2</span>) next(<span class="number">300</span>)</div><div class="line"><span class="number">1</span> ) next(<span class="number">400</span>)</div><div class="line"><span class="number">2</span>) next(<span class="number">400</span>)</div><div class="line"><span class="number">1</span> ) completed</div><div class="line"><span class="number">2</span>) completed</div></pre></td></tr></table></figure>
<h3 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h3><p>这个subject只会发送最后一个element。而且只会在subject completed后才发送。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> subject = <span class="type">AsyncSubject</span>&lt;<span class="type">Int</span>&gt;.<span class="keyword">init</span>()</div><div class="line">        </div><div class="line">subject.subscribe &#123; (event) <span class="keyword">in</span></div><div class="line">    <span class="built_in">print</span>(event)</div><div class="line">&#125;.disposed(by: bag)</div><div class="line"></div><div class="line">subject.onNext(<span class="number">100</span>)</div><div class="line">subject.onNext(<span class="number">200</span>)</div><div class="line">subject.onNext(<span class="number">300</span>)</div><div class="line">subject.onCompleted()<span class="comment">//如果没有completed，那么不会emit</span></div><div class="line"><span class="comment">///结果</span></div><div class="line">next(<span class="number">300</span>)</div><div class="line">completed</div></pre></td></tr></table></figure>
<p>​    </p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text= id="什么是subject"><a "
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://yoursite.com/2017/06/08/rxswift学习-subject/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
